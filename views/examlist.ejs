<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/css/exam_page.css" />
    <title>Document</title>
</head>

<body>

    <body>
        <% if(result) {%>
            <table border="1px solid black">
                <tr>
                    <th>Exam ID</th>
                    <th>Exam Name</th>
                    <th>Time Duration</th>
                    <th>Exam Status</th>
                    <th>Action</th>
                </tr>
                <% result.forEach(function(result){ %>
                    <tr>

                        <td>
                            <%=result.exam_id%>
                        </td>
                        <td>
                            <%=result.exam_name%>
                        </td>
                        <td>
                            <%=result.exam_time%>
                        </td>
                        <td>
                            <%=result.exam_status%>
                        </td>
                        <td>

                            <% if (result.exam_status=="Active" ) { %>
                                <button class="btn-login" onclick="popupdata('<%=result.exam_id%>')">Start</button>
                                <% }else { %>
                                    <button disabled class="btn-login"
                                        onclick="popupdata('<%=result.exam_id%>')">Start</button>
                                    <% } %>
                        </td>
                    </tr>
                    <%})%>
            </table>
            <%}%>

                <div class="overlay" onclick="closeModel()"></div>

                <div class="loginform">
                    <span>&times;</span>
                    <form action="">
                        <input type="hidden" id="id" name="id">
                        <div>
                            <label for="">Name</label>
                            <input type="text" name="name" id="name" oninput="checkNameValidName(this)" />
                            <div id="err_name" style="color: red;"></div>

                        </div>
                        <div>
                            <label for="">Email:</label>
                            <input type="text" name="email" id="email" oninput="checkEmail(this)" />
                            <div id="email_id" style="color: red;"></div>
                        </div>
                        <div>
                            <label for="">Access Code:</label>
                            <input type="text" name="accesscode" id="accesscode" oninput="checkAccesscode(this)" />
                            <div id="accesscodeError" style="color: red;"></div>
                        </div>
                        <div id="error"></div>
                        <button type="button" oninput="checksubmit()">Submit</button>
                    </form>
                </div>
    </body>


    <script>

        var name = document.getElementById('name').value;
        var email = document.getElementById('email').value;
        var accesscode = document.getElementById('accesscode').value;
        let ischeckname = true;
        let ischeckemail = true;
        let ischeckAccesscode = true;
        async function checkNameValidName(ele) {

            let input_val = ele.value;
            let err_mes = document.getElementById('err_name');

            var regex = /^[a-zA-Z ]*$/;
            if (input_val == "" || !regex.test(input_val)) {
                err_mes.innerHTML = "Please Enter Valid Name";
                ischeckname = false;
            }
            else {
                firstname = input_val;
                err_mes.innerHTML = "";
                ischeckname = true;
            }
            await checksubmit();
        }

        async function checkEmail(ele) {
            var id = document.getElementById('id').value;
            var student = await (await fetch("/studentdata")).json();
            const inputtxt = ele.value;
            const email_id = document.getElementById('email_id');
            const regExEmail = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
            if (regExEmail.test(inputtxt.trim())) {
                email = inputtxt;
                email_id.innerHTML = '';
                ischeckemail = true;
            } else {
                email_id.innerHTML = 'please Enter valid email';
                ischeckemail = false;
            }
            if (student[0].email != email) {
                email_id.innerHTML = 'email does not exits';
            }
            await checksubmit();
        }

        async function checkAccesscode(ele) {
            var id = document.getElementById('id').value;
            fetch(`/examdata?id=${id}`).then((response) => {
                return response.json()
            }).then((resdata) => {
                // console.log("resdata", resdata);
            })

            var examdata = await (await fetch(`/examdata?id=${id}`)).json();
            let input_val = ele.value;
            let err_mes = document.getElementById('accesscodeError');

            var regex = /^[a-zA-Z ]*$/;
            if (input_val == "" || isNaN(input_val)) {
                err_mes.innerHTML = "Please Enter Valid Accesscode";
                ischeckAccesscode = false;
            }
            else
                if (examdata[0].exam_access_code != input_val) {
                    err_mes.innerHTML = "Accesscode does not match";
                    ischeckAccesscode = false;
                }
                else {
                    firstname = input_val;
                    err_mes.innerHTML = "";
                    ischeckAccesscode = true;
                }
            await checksubmit();
        }



        async function checksubmit() {
            if (ischeckname && ischeckemail && ischeckAccesscode) {
                console.log("data match suucessfully")
            }
            else {
                console.log("data does not match");
            }
        }


        async function popupdata(id) {
            document.querySelector(".overlay").classList.add("showoverlay");
            document.querySelector(".loginform").classList.add("showloginform");
            document.getElementById('id').value = id;
        }
        ;

        function closeModel() {
            document.querySelector(".overlay").classList.remove("showoverlay");
            document.querySelector(".loginform").classList.remove("showloginform");
        }

        // var btnlogin = document.querySelector(".btn-login"); //Button
        // btnlogin.addEventListener("click", showmodel); //Button click

        var c = document.querySelector("span"); //Button
        c.addEventListener("click", closeModel); //Button click
    </script>

</html>